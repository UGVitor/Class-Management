<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Aula</title>
    <link rel="stylesheet" href="../../style/telasCadastro.css">
    <link rel="icon" href="../../img/icon.png">
    <style>
        /* Estilos continuam os mesmos... */
    </style>
</head>
<body>
    <div class="navbar">
        <header>
            <h1><a href="#">Aula</a></h1>
            <nav>
                <li><a href="home.html">Home</a></li>
            </nav>
        </header>
    </div>
    <div id="app">
        <form @submit.prevent="createAula">
            <h2>Criar Aula</h2>
            <div class="form-group">
                <label for="descricao">Descrição:</label>
                <input type="text" v-model="aula.descricao" required />
            </div>
            <div class="form-group">
                <label for="disciplina">Disciplina:</label>
                <select v-model="aula.disciplina" required>
                    <option disabled value="">Selecione uma Disciplina</option>
                    <option v-for="disciplina in disciplinas" :key="disciplina.id" :value="disciplina.id">{{ disciplina.nome }}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="diaSemana">Dia da Semana:</label>
                <select v-model="aula.diaSemana" required>
                    <option disabled value="">Selecione um dia</option>
                    <option v-for="dia in diaSemana" :key="dia.id" :value="dia.id">{{ dia.dia }}</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="horarioInicio">Horário de Início:</label>
                <select v-model="aula.horarioInicio" required>
                    <option disabled value="">Selecione um horário</option>
                    <option v-for="horario in horarios" :key="horario.id" :value="horario.id">{{ horario.horaInicio }}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="horarioTermino">Horário de Término:</label>
                <select v-model="aula.horarioTermino" required>
                    <option disabled value="">Selecione um horário</option>
                    <option v-for="horario in horarios" :key="horario.id" :value="horario.id">{{ horario.horaTermino }}</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="sala">Sala:</label>
                <select v-model="aula.sala" required>
                    <option disabled value="">Selecione uma Sala</option>
                    <option v-for="sala in salas" :key="sala.id" :value="sala.id">{{ sala.sala }}</option>
                </select>
            </div>
            <div class="form-group">
                <button type="submit">Criar Aula</button>
            </div>
        </form>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script>
        new Vue({
            el: '#app',
            data: {
                aula: {
                    descricao: '',
                    disciplina: '',
                    diaSemana: '',
                    horarioInicio: '',
                    horarioTermino: '',
                    sala: ''
                },
                disciplinas: [],
                diaSemana: [],
                horarios: [],
                salas: []
            },
            created() {
                this.fetchDisciplinas();
                this.fetchHorarios();
                this.fetchSalas();
                this.fetchDiasSemana(); 
            },
            methods: {
                fetchDisciplinas() {
                    fetch('http://localhost:8081/api/v1/disciplinas')
                        .then(response => response.json())
                        .then(data => {
                            this.disciplinas = data;
                        })
                        .catch(error => {
                            console.error('Erro ao carregar disciplinas:', error);
                        });
                },
                fetchHorarios() {
                    fetch('http://localhost:8081/api/v1/horarios')
                        .then(response => response.json())
                        .then(data => {
                            this.horarios = data;
                        })
                        .catch(error => {
                            console.error('Erro ao carregar os horários:', error);
                        });
                },
                fetchSalas() {
                    fetch('http://localhost:8081/api/v1/salas')
                        .then(response => response.json())
                        .then(data => {
                            this.salas = data;
                        })
                        .catch(error => {
                            console.error('Erro ao carregar salas:', error);
                        });
                },
                fetchDiasSemana() {
                    fetch('http://localhost:8081/api/v1/diasSemana')
                        .then(response => response.json())
                        .then(data => {
                            this.diaSemana = data;
                        })
                        .catch(error => {
                            console.error('Erro ao carregar os dias da semana:', error);
                        });
                },
                createAula() {
                    const aulaData = {
                        descricao: this.aula.descricao,
                        disciplina: { id: this.aula.disciplina },
                        diaSemana: this.aula.diaSemana,
                        horarioInicio: this.aula.horarioInicio,
                        horarioTermino: this.aula.horarioTermino,
                        sala: this.aula.sala
                    };

                    console.log('Dados enviados:', aulaData); // Verifique os dados enviados

                    fetch('http://localhost:8081/api/v1/aulas', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(aulaData)
})
.then(response => {
    console.log('Status da resposta:', response.status); // Status HTTP
    if (!response.ok) {
        return response.text().then(text => {
            console.error('Erro na resposta da API:', text); // Exibe corpo da resposta se erro
            throw new Error(`Erro ao criar a aula: ${text}`);
        });
    }
    return response.json();
})
.then(data => {
    console.log('Aula criada com sucesso:', data); // Sucesso
    alert('Aula criada com sucesso!');
    this.aula = {
        descricao: '',
        disciplina: '',
        diaSemana: '',
        horarioInicio: '',
        horarioTermino: '',
        sala: ''
    };
})
.catch(error => {
    console.error('Erro no envio:', error); // Mostra erro detalhado
    alert('Erro ao criar a aula, tente novamente.');
});

                }
            }
        });
    </script>
</body>
</html>
